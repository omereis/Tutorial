<HTML>
<HEAD><TITLE>Buttons</TITLE>
<SCRIPT type="text/javascript">
//----------------------------------------------------------------------------
/*
*/
function handleFileSelect(evt) {
   var files = evt.target.files; // FileList object

    // files is a FileList of File objects. List some properties.
   var output = [];
   ouput.push(files.size);
    for (var i = 0, f; f = files[i]; i++) {
      output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
                  '</li>');
    }
  document.getElementById('files_list').innerHTML = '<ul>' + output.join('') + '</ul>';
}
//----------------------------------------------------------------------------
function handleButtonClick(evt) {
   var files = evt.target.files; // FileList object
  alert (document.getElementById('files_list').nodeValue)
}
  document.getElementById('files').addEventListener('change', handleFileSelect, false);
  document.getElementById('file_btn').addEventListener('change', handleButtonClick, false);
//----------------------------------------------------------------------------
function HandleBrowseClick()
{
    var fileinput = document.getElementById("browse");
    fileinput.click();
}
//----------------------------------------------------------------------------
function Handlechange()
{
  var fileinput = document.getElementById("browse");
  var textinput = document.getElementById("filename");
  textinput.value = fileinput.value;
}
//----------------------------------------------------------------------------
function addDoc()
{
  var file=document.getElementById("myFile").files[0]; //for input type=file
  var reader = new FileReader();

  document.getElementById('debug').innerHTML = "Hello<br>World";
// If we use onloadend, we need to check the readyState.
  reader.onloadend = function(evt) {
    if (evt.target.readyState == FileReader.DONE) { // DONE == 2
        lines = evt.target.result;

        try {
          var str, strCell, strHtml, lines, equals;
          var cell_start = '<td style="width:50%;">';
          var arr = new Uint8Array(lines);
          strCell = "";
          lines = equals = 0;
          strHtml='<table border="2" style="table-layout:fixed;" width="80%"><tr>';
          str = String.fromCharCode.apply(String, arr);
          strHtml += cell_start;
          var strDebug="";
          for (var n=10 ; n < 20 ; n++) {
            strDebug += "string[" + n + "]: " + str[n] + ", " + str.charCodeAt (n) + "\n";
          }
          alert (strDebug);
          for (var n=0 ; n < str.length ; n++) {
            if (str[n] == "=") {
              alert('html before: ' + strHtml);
              strHtml += strCell + "</td>" + cell_start;
              alert('html AFTER: ' + strHtml);
              strCell = "";
              equals++;
            }
            else if (str.charCodeAt(n) == 13) {
              strHtml += "</tr>" + strCell + "</td><tr>";
              strCell = "";
              lines++;
            }
            else {
              strCell += str[n];
            }
/*
//            strCell += str[n];
            if (str.charCodeAt(n) == 13) {
              strCell += "<br>";
*/
          }
          var sw = new StreamWriter ("debug.txt");
          sw.writeLine (strHtml);
          sw.Flush();
          sw.Close();
          strHtml += "</tr></table>";
          document.getElementById('byte_content').innerHTML = strHtml;//strCell;//str;
          document.getElementById('file_content').innerHTML = strHtml;
          alert ('lines: ' + lines + "\nequals: " + equals);
        }
        catch (e) {
          alert (e);
        }
      }
    }

//  reader.readAsText(file);
  reader.readAsArrayBuffer(file);
}
//----------------------------------------------------------------------------
</SCRIPT>
<!-- <div style='visibility:hidden;text-align:left;background:#ccc;border:1px solid black;position: absolute;left:100;z-index:1;padding:5;' id='out_box'></div> -->
</HEAD>
<BODY onload>

<table border="0" style="width:100%;">
  <tr>
    <td align="center"><button type="button" id="btnLoad"   onclick="alert('Load')">Load...</button></td>
    <td align="center"><button type="button" id="btnSave"   onclick="alert('Save!')">Save</button></td>
    <td align="center"><button type="button" id="btnSaveAs" onclick="alert('Save As')">Save As...</button></td>
  </tr>
</table>

<input type="file" id="myFile">
<button type="button" onclick="addDoc()">Add Document</button>
<p id="DisplayText"></p>

<table border="1" style="table-layout:fixed;" width="80%">
  <tr>
    <td style="width:50%;">
      <div id="byte_content"></div>
    </td>
    <td width="50%">
      <div id="debug"></div>
    </td>
  </tr>
</table>
<div id="file_content"></div>


</BODY>
