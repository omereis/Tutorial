#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <conio.h>
#include <ctype.h>
#include <dir.h>

//-----------------------------------------------------------------------------
int get_cli_size(struct FileMaker *pfm,  int argc, char *argv[]);
void create_files (struct FileMaker *pfm);
//-----------------------------------------------------------------------------
struct FileMaker {
	int count;
	int size;
	char mult;
};
//-----------------------------------------------------------------------------
int main (int argc, char *argv[])
{
	struct FileMaker fm;
	int nSize;
	printf ("Creating file with givn size\n");
	nSize = get_cli_size(&fm, argc, argv);
	create_files (&fm);
	printf ("Hit key to continue\n");
	getch ();
	exit(0);
}
//-----------------------------------------------------------------------------
int get_cli_size(struct FileMaker *pfm,  int argc, char *argv[])
{
	int n, ok;
	char str[1024], mult;
#ifdef   _DEBUG
	printf("Debug mode\n");
	pfm->count = 10;
	pfm->size = 5;
	pfm->mult = 'M';
#else
	if (argc > 1) {
		pfm->count = atoi (argv[1]);
	}
	if (argc > 2) {
		pfm->size = atoi (argv[2]);
	}
	ok = 0;
	if (argc >= 3) {
		if (strlen(argv[3]) == 1) {
			mult = tolower(argv[3][0]);
			if ((mult == 'k') || (mult == 'm') || (mult == 'g')) {
				ok = 1;
			}
		}
//		pfm->size = atoi (argv[2]);
	}
	if (ok)
		pfm->mult = mult;
	else
		pfm->mult = 'm';
	if (pfm->count == 0)
		pfm->count = 1;
	if (pfm->size == 0)
		pfm->size = 1;
#endif
/*
*/
	printf("fm.count=%d\n", pfm->count);
	printf("fm.size=%d\n", pfm->size);
	printf("fm.mult=%c\n", pfm->mult);
}
//-----------------------------------------------------------------------------
static const char *szNameBase = "tstfile";
//-----------------------------------------------------------------------------
void remove_old ()
{
	struct ffblk ffblk;
	char szName[1024];
	int done;

	sprintf (szName, "%s*.*", szNameBase);

	done = findfirst (szName, &ffblk, FA_HIDDEN | FA_SYSTEM);
	while (done == 0) {
		remove (ffblk.ff_name);
		done = findnext (&ffblk);
	}

}
//-----------------------------------------------------------------------------
void create_files (struct FileMaker *pfm)
{
	FILE* file;
	char str[1024], szNameFmt[10];
	int n;

	remove_old ();
	sprintf (str, "%s*.*", szNameBase);


	if (access()) {

	}
	if (remove(str) != 0) {
		printf("error delleting files");
	}
	else {
		sprintf (szNameFmt, "%%0%dd", pfm->count);
		for (n=0 ; n < pfm->count ; n++) {
			sprintf (szNameFmt, "%%0%dd", pfm->count);

		}
	}
}
//-----------------------------------------------------------------------------

